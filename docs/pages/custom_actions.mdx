import { Tabs } from "nextra/components";
import { Callout } from "nextra/components";

# Custom Actions

Admyral supports the creation of custom actions as well as the usage of third-party libraries within custom actions.

<Callout type="info">
	With Admyral's infrastructure, only the latest versions of packages are
	being used. Due to this, you don't have to worry about maintenance of
	packages anymore as this will be done automatically.
</Callout>

## Creation of Custom Actions

There are three ways to create custom actions:

1. As a separate function:
   a. Within the workflow Python file
   b. Within a Python file dedicated for the specific custom action
2. As a sub-part of the workflow function

Using (1.a) or (1.b), the structure of the custom action is as follows:

```python
@action(
    display_name="Send two Slack Messages",
    display_namespace="Slack",
    description="Send two Slack messages in a row to the same person",
)
def send_two_slack_messages(
    user_id
):
    ...
```

After creating your custom action, push it to Admyral using the following CLI command to use it in other workflows or within the no-code editor:

```bash
admyral action <your_custom_action.py> push
```

For way (2), defining custom actions within the workflow function, they have to be wrapped by two comments: `# {% custom %}` and `# {% endcustom %}`. In doing so, the custom action can be displayed in the no-code editor as a single node.

it looks like the following:

```python
@workflow
def workflow_function ():
    # some workflow logic

    # define the custom action enclosed by the following comments:

    # {% custom %}

    alert_messages = []
    for alert in alerts:
        alert_messages.append({
        "channel": slack_channel_id,
        "text": f"New alert: {alert['name']}",
        "blocks": [
            {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": f"*{alert['description']}*"
                }
            }
        ]
    })

    # {% endcustom %}

    # continue you workflow logic here

```

TODO: Does the custom action have to be pushed to Admyral using the CLI as well?

## Usage of Custom Actions

<Tabs items={['Code', 'No-Code']}>
    <Tabs.Tab>
        Import your custom action, e.g. `hello_world`, into your Python file to be able to use it
    	```python
        from admyral.actions import hello_world
        ```

        Use your imported custom action as a regular function:

        ```
    	@workflow(
    		description="example_workflow",
    		triggers=[Webhook()],
    	)
    	def slack_send_message(payload: dict[str, JsonValue]):
    		text = hello_world()

            send_slack_message(
    			channel_id="C0000000000",
    			text=text,
    			secrets={"SLACK_SECRET": "slack_secret"},
    		)
    	```
    </Tabs.Tab>
    <Tabs.Tab>
    	Within the No-Code Workflow Editor, custom actions appear in the given namespace (= grouping), e.g. Slack or Admyral. From there, you can simply drag-and-drop them to use them.
    </Tabs.Tab>

</Tabs>
